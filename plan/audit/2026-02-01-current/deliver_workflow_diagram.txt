Deliver Workflow Diagram (at) â€” /at:run
Date: 2026-02-01

Legend:
  (A) agentic step (subagent via Task)
  (S) script step (uv run ...)
  (H) hook step (Claude Code hooks calling scripts)

User request
   |
   v
/at:run (deliver)
   |
   +--> [0] rollback mode? (optional)
   |       (S) scripts/checkpoint/restore_checkpoint.py
   |
   +--> [0.5] deterministic rerun mode? (optional)
   |       (S) scripts/workflow/run_deterministic.py
   |
   +--> [1] create/resume session
   |       (S) scripts/session/create_session.py
   |       OUT: SESSION_DIR/** + session.json
   |
   +--> [2] write request
   |       (tool) Write -> SESSION_DIR/inputs/request.md
   |
   +--> [3] build context pack
   |       (S) scripts/context/build_context_pack.py
   |       OUT: SESSION_DIR/inputs/context_pack.md
   |
   +--> [4] plan
   |       (A) agents/action-planner.md
   |       OUT: SESSION_DIR/planning/actions.json + checklists
   |       (H) PostToolUse Write -> scripts/hooks/validate_actions_write.py
   |
   +--> [5] validate plan
   |       (S) scripts/validate/validate_actions.py
   |
   +--> [6] build per-task contexts
   |       (S) scripts/context/build_task_contexts.py
   |       OUT: inputs/task_context/<task_id>.md + manifest
   |
   +--> [7] checkpoint
   |       (S) scripts/checkpoint/create_checkpoint.py
   |
   +--> [8] execute tasks (parallel-safe by default)
   |       (A) agents/implementor.md + agents/tests-builder.md
   |       OUT: implementation/tasks/<tid>.yaml
   |            testing/tasks/<tid>.yaml
   |       (H) PreToolUse Write/Edit -> scripts/hooks/enforce_file_scope.py
   |       (H) SubagentStop -> scripts/hooks/on_subagent_stop.py
   |
   +--> [9] deterministic gates
   |       (S) scripts/validate/validate_task_artifacts.py
   |       (S) scripts/validate/plan_adherence.py
   |       (S) scripts/validate/parallel_conformance.py
   |       (S) scripts/quality/run_quality_suite.py
   |
   |       (A) agents/docs-keeper.md (always-on docs)
   |           - Updates docs/PROJECT_CONTEXT.md, docs/ARCHITECTURE.md, docs/adr/* (as needed)
   |           - Maintains docs/DOCUMENTATION_REGISTRY.json (required 'when' field)
   |       (S) scripts/docs/generate_registry_md.py
   |           - Generates docs/DOCUMENTATION_REGISTRY.md from JSON
   |       (S) scripts/validate/docs_gate.py
   |           - Validates docs registry + enforces MD drift check
   |
   |       (S) scripts/validate/validate_changed_files.py
   |       (S) scripts/compliance/generate_compliance_report.py
   |
   '--> [10] progress update
           (S) scripts/session/session_progress.py

